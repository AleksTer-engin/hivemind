# ЖУРНАЛ АРХИТЕКТУРНЫХ РЕШЕНИЙ (ADR)

## ADR-001: Выбор NATS как событийной шины
**Дата**: 2026-02-22
**Проблема**: Необходима надёжная и быстрая коммуникация между микросервисами
**Решение**: Использовать NATS (не Redis, не Kafka)
**Причина**:
- Высокая производительность (миллионы сообщений в секунду)
- Простота (один бинарник, нет сложного конфигурирования)
- At-least-once доставка через JetStream
- Поддержка различных паттернов (pub/sub, request/reply, очередь)
**Статус**: Принято
**Альтернативы**:
- Kafka: избыточно сложна, тяжела
- Redis: не гарантирует доставку при сбоях
- RabbitMQ: медленнее, сложнее

---

## ADR-002: Три типа баз данных
**Дата**: 2026-02-22
**Проблема**: Разные типы данных требуют разных моделей хранения
**Решение**:
- Postgres — реляционные данные (пользователи, метаданные)
- Neo4j — графовые связи (отношения между сущностями)
- Qdrant — векторные эмбеддинги (поиск по смыслу)
**Причина**:
- Postgres: надёжность, ACID, знакомство команды
- Neo4j: естественное представление связей, скорость обхода графа
- Qdrant: специализирован для работы с эмбеддингами, лучше чем pgvector
**Статус**: Принято

---

## ADR-003: API Gateway на Go
**Дата**: 2026-02-22
**Проблема**: Нужна единая точка входа с высокой производительностью
**Решение**: Написать API Gateway на Go
**Причина**:
- Высокая производительность
- Малое потребление памяти
- Отличная поддержка конкурентности
- Простота развёртывания (один бинарник)
**Статус**: Принято

---

## ADR-004: Классификатор на Python
**Дата**: 2026-02-22
**Проблема**: Классификация текстов требует ML-библиотек
**Решение**: Использовать Python с FastAPI
**Причина**:
- Богатая экосистема ML (transformers, scikit-learn)
- FastAPI для лёгкого API
- Прототипирование важнее производительности
**Статус**: Принято

---

## ADR-005: Структура сервисов
**Дата**: 2026-02-22
**Проблема**: Как организовать код сервисов
**Решение**:
services/
api-gateway/ # Go
classifier/ # Python
embedder/ # (будет)
linker/ # (будет)
hivemind-ui/ # Python

text
**Причина**:
- Каждый сервис в отдельной папке
- Можно разрабатывать независимо
- Разные языки не мешают друг другу
**Статус**: Принято

---

## ADR-006: Инициализация БД
**Дата**: 2026-02-22
**Проблема**: Как создавать начальные схемы БД
**Решение**: Использовать init-scripts/ с SQL-файлами
**Причина**:
- Docker монтирует папку и выполняет скрипты при первом запуске
- Версионируется вместе с кодом
- Простота
**Статус**: Принято

---

## ADR-007: Архитектура отсутствующих сервисов (embedder, linker)
**Дата**: 2026-02-22
**Проблема**: Сервисы ещё не написаны
**Решение**:
- **embedder**: Python + sentence-transformers для создания эмбеддингов
- **linker**: Go для производительности при обходе графа
**Причина**:
- Embedder: нужны готовые модели из Python-экосистемы
- Linker: потенциально высокая нагрузка на обход графа
**Статус**: В планах
